<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pj.system.mapper.DempMapper" >
  <resultMap id="BaseResultMap" type="com.pj.system.pojo.Demp" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="frontrank" property="frontrank" jdbcType="INTEGER" />
    <result column="companyid" property="companyid" jdbcType="INTEGER" />
    <result column="number" property="number" jdbcType="VARCHAR" />
    <result column="pId" property="pId" jdbcType="INTEGER" />
    <result column="isdelete" property="isdelete" jdbcType="INTEGER" />
    <result column="hierarchy" property="hierarchy" jdbcType="INTEGER" />
  </resultMap>
  <select id="selectEliminateSubset" parameterType="java.lang.Integer" resultMap="BaseResultMap">
 	SELECT
		  d.id, d.name, d.frontrank, d.companyid, d.number, d.pId, d.isdelete, d.hierarchy
	FROM
	t_demp d
	INNER JOIN (
		SELECT
			companyid
		FROM
			t_demp
		WHERE
			id = #{id}
	) de ON d.companyid = de.companyid 
	<where>
		d.id NOT IN (
			SELECT
				id
			FROM
				t_demp
			WHERE
				FIND_IN_SET(id, getChildLst(#{id}))
		) AND d.isdelete = 0
	</where>
  </select>
  <select id="selectDempParentListById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
 	SELECT
		 id,name,frontrank,companyid,number,pId,isdelete,hierarchy
	FROM 
		t_demp 
	where 
		FIND_IN_SET(id, getParentList(#{id}))
  </select>
  <select id="selectDempChildListById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
 	SELECT
		 id,name,frontrank,companyid,number,pId,isdelete,hierarchy
	FROM 
		t_demp 
	where 
		FIND_IN_SET(id, getChildLst(#{id}))
  </select>
</mapper>